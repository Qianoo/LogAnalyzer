<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyzer Result</title>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            padding: 10px;
            margin: 0;
            background-color: #f5f5f5;
            font-size: 1.5rem;
        }

        #container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #keyword-list {
            width: 20%;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            padding: 15px;
        }

        .right-panel {
            width: 80%;
            display: flex;
            flex-direction: column;
        }

        #log-display {
            height: 70%;
            overflow-y: auto;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        #analysis-result {
            height: 30%;
            overflow-y: auto;
            padding: 15px;
            background-color: #ffffff;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .keyword {
            margin: 8px 0;
            padding: 8px 12px;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .keyword:hover {
            background-color: #e9ecef;
        }

        .highlight {
            background-color: #fff3cd;
            padding: 2px 0;
        }

        .line-number {
            color: #6c757d;
            margin-right: 10px;
            -webkit-user-select: none;
               -moz-user-select: none;
                    user-select: none;
        }

        .keyword-block {
            margin: 8px 0;
            padding: 6px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .keyword-tag {
            font-size: 0.8rem;
            padding: 2px 6px;
            margin: 2px;
            border-radius: 3px;
            background-color: #e7f3ff;
            border: 1px solid #b3d7ff;
            cursor: pointer;
        }

        .keyword-tag:hover {
            background-color: #cce5ff;
        }

        .keyword-tag .line-info {
            font-size: 0.8em;
            color: #666;
            margin-left: 4px;
        }

        .line-highlight {
            background-color: #fff3cd;
            animation: highlight 2s;
        }

        @keyframes highlight {
            from {
                background-color: #ffeeba;
            }

            to {
                background-color: #fff3cd;
            }
        }

        .block-header {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #filter-container {
            padding: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .filter-tag {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
        }

        .filter-tag.active {
            background-color: #28a745;
            color: white;
        }

        .filter-tag.inactive {
            background-color: #e9ecef;
            color: #666;
        }

        .markdown {
            padding: 0.8rem;
            font-size: 0.9rem;
        }

        .markdown h1 {
            font-size: 1.4em;
            margin-top: 0.8em;
            margin-bottom: 0.4em;
        }

        .markdown h2 {
            font-size: 1.2em;
            margin-top: 0.8em;
            margin-bottom: 0.4em;
        }

        .markdown h3 {
            font-size: 1.1em;
            margin-top: 0.8em;
            margin-bottom: 0.4em;
        }

        .markdown ul,
        .markdown ol {
            padding-left: 1.5em;
            margin-bottom: 0.8em;
        }

        .markdown li {
            margin-bottom: 0.3em;
        }

        .markdown code {
            background-color: #f0f0f0;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: monospace;
        }

        .markdown pre {
            background-color: #f5f5f5;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .markdown blockquote {
            border-left: 4px solid #ddd;
            padding-left: 1em;
            margin: 1em 0;
            color: #666;
        }

        .markdown p {
            margin-bottom: 0.8em;
        }

        /* 添加容器样式 */
        .split-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 150px);
            /* 减去其他元素的高度 */
            position: relative;
        }

        /* 日志显示窗口 */
        #log-display {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            min-height: 100px;
            /* 最小高度 */
        }

        /* 可拖动的分隔条 */
        .resizer {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            cursor: row-resize;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
        }

        /* 分隔条中间的线 */
        .resizer::after {
            content: '';
            display: block;
            width: 30px;
            height: 2px;
            background: #999;
            margin: 3px auto;
        }

        /* 分析结果窗口 */
        #analysis-result {
            height: 200px;
            /* 初始高度 */
            overflow-y: auto;
            padding: 10px;
            min-height: 100px;
            /* 最小高度 */
        }

        /* 拖动时的遮罩层 */
        .resize-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
        }

        /* 添加进度条样式 */
        .progress-container {
            display: none;
            /* 默认隐藏 */
            width: 100%;
            padding: 10px;
            background-color: #f5f5f5;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .progress-bar {
            width: 0%;
            height: 4px;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 4px;
        }
    </style>
  <script type="module" crossorigin>(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();function M(r){const n=["Segmentation fault","core dumped","Bus error","undefined reference","stack overflow","double free","invalid pointer","malloc failed","SIGABRT","SIGSEGV","NullPointerException","ArrayIndexOutOfBoundsException","ClassNotFoundException","NoSuchMethodError","IllegalArgumentException","OutOfMemoryError","StackOverflowError","ClassCastException","ANR","FATAL EXCEPTION","ActivityManager: Force finishing activity","E/AndroidRuntime","W/ActivityThread","StrictMode","kernel panic","Oops","BUG:","Call Trace","slab corruption","general protection fault","I/O error","bad page state","Error","Critical","Failed","Exception","Timeout","Permission denied","Device not found"];function*i(c){const g=c.split(`
`);for(let u=0;u<g.length;u++)yield{line:g[u],index:u}}const s=[];let t=null,d=[];const e=i(r);for(const{line:c,index:g}of e){d.push(c),d.length>10&&d.shift();const u=n.filter(S=>c.includes(S));u.length>0?(t?(t.keywords.push(...u),t.endLine=Math.min(g+10,t.startLine+300)):t={startLine:Math.max(0,g-10),endLine:Math.min(g+10),keywords:u,lines:[...d]},t.lines.push(c)):t&&(t.lines.push(c),(g>=t.endLine||t.lines.length>=300)&&(s.push(t),t=null,d=[c]))}return t&&s.push(t),s}const w={defaultLogAnalysis:`作为日志分析专家,请你分析日志,推测可能出问题的模块,根据提供的owner联系列表,推测出模块的owner和Manager(最多输出3个可能的联系人),并按照下面的模板回复：

1. 概述
- 日志类型
- 涉及组件

2. 原因分析
- 问题根源
- 关联性分析
- 系统模块定位

3. 解决方案
- 修复建议
- 预防措施

4.可能的owner和Manager

请注意这是owner联系列表,你需要在owner联系列表中找到可能的联系人:
Platform (Manager: Victor Wan)
uboot: Tao Zeng
bl2: Tao Zeng
bl31: Tao Zeng
kernel: Jianxin Pan
bl30: Qiufang Dai
Storage drivers: Yonghui Yu
gpio: Qianggui Song
pinctrl: Qianggui Song
i2c: Jian Hu
clk tree: Jian Hu
spi: Sunny Luo
spi nand: Sunny Luo
spi nor flash: Sunny Luo
pwm: Bichao Zheng
emmc: Long Yu
sdio: Liang Yang
WIFI/BT: Larson Jiang
wifi driver: Rongjun Chen
wifi driver (freertos): Bo Li
wifi driver (buildroot): Jiabin Chen
bt driver: Qiu Zeng
secureos: Peifu Jiang, Pengguang Zhu, Rui Guo
freertos: Jianxiong Pan
usb: Yue Wang
ethernet phy: Zhuo Wang
uart: Qi Duan, Yu Tu
Audio (Manager: Jian Xu)
audio driver: Shuai Li
audio hal: Shuai Li
dsp driver: Jiebin Chen
audio eq/drc: Zhe Wang
dolby/dts MS12: Yujie Wu

Display / Graphic (Manager: Simon Zheng)
OSD: Brain Zhu
camera ISP: Xiaoxin Cao
Graphic: Sky Zhou
buildroot DRM: Ao Xu
NPU driver: Xingwei Zhou
NPU APP: Deng Liu
OSD driver: Pengcheng Chen
GE2D/GDC: Jian Cao
PIP: Jintao Xu
ISP driver: Junwei Ma, Jiacheng Mei, Keke Li
camera hal: Dong Wei
camera IQ: Yu Zhang

HDMI (Manager: Frank Zhao)
Panel Cvbs: Evoke Zhang
HDMI TX: Zongdong Jiao
HDMI RX: Lei Yang, Yicheng Shen
Media (Manager: Zhi Zhou)
decoder: Hui Zhang
Android player: Lifeng Cao
DRM player: Shipeng Sun, Tao Guo

Android AE (Manager: Tellen Yu)
TV framework: Kieth Liu
CEC: An Xi
camera apk: Jie Yuan
Android System: Shuide Chen
Android 公版 (Manager: Tao Dong)
OTT release: Gongwei Chen
TV release: Lei Qian
DS release: Chunlong Cao
system control: Kaifu Hu
burning tools: Yihui Wu
OTA: Zhigang Yu

Buildroot (Manager: Guofeng Tang)
RDK: Jun Zhang, Daogao Xu
IPC SDK: Hengrui Li, Zhengyu Gao, Xuequan Feng, Yongbin He, Qiang Wei
ISP/encoder SDK: Yang Su
HW (Manager: Kun Zhang)
DDR SW: Jiaxin Ye, Zhiguang Ouyang
IPC HW: Chuanting Xu
IPC/OTT HW: Yuanyuan Li
FAE HW: Linlin Cao
TV HW: Siwei Chen
HW: Jie Feng

IT
服务器: Jia Wang, Rocky Duan
设备: Jianjun Xi, Penghui Wang
QA (Managers: Xiuyue Zhang, Ping Xiong)
Amazon: Chen Chen
OTT: Lingling Yu
IPC: Nannan Meng
`,detailedLogAnalysis:`作为日志分析专家,请详细分析以下日志：

1. 日志概述
- 日志类型和格式
- 时间范围分析
- 涉及的系统组件
- 日志严重程度分布

2. 问题诊断
- 错误模式识别
- 异常事件时序
- 系统状态分析
- 性能指标评估

3. 根因分析
- 直接原因
- 潜在因素
- 系统瓶颈
- 组件间依赖

4. 解决方案
- 即时修复建议
- 长期优化方案
- 监控建议
- 预防措施`,simpleLogAnalysis:`简要分析此日志：
1. 问题描述
2. 原因分析
3. 解决方案`};function I(r="defaultLogAnalysis"){return`${w.owner_prompt}

${w[r]}`}async function k(){try{const o=await(await fetch("/config/custom-prompts.json")).json();Object.assign(w,o)}catch(r){console.warn("Failed to load custom prompts:",r)}}k();let h=[],L=[],m=new Map,y=null;const E=document.getElementById("filter-container"),p=document.getElementById("keyword-list"),f=document.getElementById("log-display"),v=window.markdownit({html:!0,linkify:!0,typographer:!0});window.addEventListener("message",async r=>{const o=document.getElementById("progress-container"),a=document.getElementById("progress-bar"),l=document.getElementById("progress-text");o.style.display="block",a.style.width="0%",l.textContent="正在解析日志文件...",await new Promise(n=>requestAnimationFrame(n));try{await new Promise(e=>setTimeout(e,0));const n=r.data;L=n.split(`
`);const i=L.length;l.textContent="正在解析日志内容...",h=await new Promise(e=>{setTimeout(()=>{const c=M(n);a.style.width="30%",e(c)},0)}),l.textContent="正在处理关键字...",await new Promise(e=>setTimeout(e,0));const s=new Set;for(let e=0;e<h.length;e++){h[e].keywords.forEach(u=>s.add(u));const g=Math.round(30+e/h.length*30);a.style.width=`${g}%`,e%10===0&&await new Promise(u=>setTimeout(u,0))}l.textContent="正在更新界面...",a.style.width="60%",await new Promise(e=>setTimeout(e,0)),E.innerHTML="",p.innerHTML="",m=new Map,s.forEach(e=>m.set(e,!0));let t=0;const d=s.size;for(const e of s){const c=document.createElement("span");c.className="filter-tag active",c.textContent=e,c.onclick=()=>{const u=m.get(e);m.set(e,!u),c.className=`filter-tag ${u?"inactive":"active"}`,C()},E.appendChild(c),t++;const g=Math.round(60+t/d*20);a.style.width=`${g}%`,t%5===0&&await new Promise(u=>setTimeout(u,0))}l.textContent="正在渲染内容...",a.style.width="80%",await new Promise(e=>setTimeout(e,0)),C(),a.style.width="100%",l.textContent="处理完成",setTimeout(()=>{o.style.display="none"},1e3)}catch(n){console.error("Error processing log:",n),l.textContent="处理出错: "+n.message,a.style.backgroundColor="#ff4444",setTimeout(()=>{o.style.display="none"},3e3)}});function A(r){f.innerHTML="";const o=document.createElement("div");o.className="block-header";const a=r.endLine-r.startLine+1,l=a>=500?" (Truncated to 500 lines)":"";if(o.textContent=`Log Block (Lines ${r.startLine+1} - ${r.endLine+1})${l}`,f.appendChild(o),L.slice(r.startLine,r.endLine+1).forEach((i,s)=>{const t=document.createElement("div"),d=r.startLine+s;t.id=`line-${d}`,t.innerHTML=`<span class="line-number">${d+1}</span>${i}`,r.keywords.some(e=>m.get(e)&&i.includes(e))&&t.classList.add("highlight"),f.appendChild(t)}),a>=500){const i=document.createElement("div");i.className="truncate-note",i.style.color="#666",i.style.padding="10px",i.style.fontStyle="italic",i.textContent="Note: Log block has been truncated to 500 lines for better performance.",f.appendChild(i)}}function C(){T(),p.innerHTML="";const r=h.filter(o=>o.keywords.some(a=>m.get(a)));if(r.forEach((o,a)=>{const l=document.createElement("div");l.className="keyword-block";const n=document.createElement("div");n.className="keyword-tags",o.keywords.filter(s=>m.get(s)).forEach(s=>{const t=document.createElement("span");t.className="keyword-tag";const d=[];L.slice(o.startLine,o.endLine+1).forEach((e,c)=>{e.includes(s)&&d.push(o.startLine+c)}),t.innerHTML=`${s} <span class="line-info">(${d.length})</span>`,t.onclick=()=>{T(),A(o),document.querySelectorAll(".line-highlight").forEach(e=>{e.classList.remove("line-highlight")}),setTimeout(()=>{if(d.length>0){const e=document.getElementById(`line-${d[0]}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("line-highlight"))}},100)},n.appendChild(t)}),l.appendChild(n),p.appendChild(l)}),r.length>0){const o=p.querySelector(".keyword-block");o&&o.querySelector(".keyword-tag").click()}else f.innerHTML='<div style="padding: 20px; text-align: center; color: #666;">No matching log blocks</div>'}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("analyze-btn");r&&r.addEventListener("click",P)});async function P(){const r=document.getElementById("log-display"),o=document.getElementById("analysis-result"),a=document.getElementById("analyze-btn"),l=r.innerText;a.disabled=!0,a.textContent="分析中...",o.innerHTML='<div class="markdown">正在分析，请等待...</div>',y=new AbortController;try{const n=b("/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:I("defaultLogAnalysis")},{role:"user",content:l}],stream:!0}),signal:y.signal});o.innerHTML="";let i="";for await(const s of n){const t=s.choices[0].delta.content;if(t){i+=t;const d=v.render(i);o.innerHTML=`<div class="markdown">${d}</div>`}}}catch(n){console.error("Analysis error:",n),o.innerHTML=`<div class="markdown">分析出错: ${n.message}</div>`}finally{a.disabled=!1,a.textContent="分析日志"}}function T(){y&&(y.abort(),y=null);const r=document.getElementById("analysis-result");r.innerHTML=""}async function*b(r,o){const a=await fetch(r,o);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const l=a.body.getReader(),n=new TextDecoder;let i="";for(;;){const{value:s,done:t}=await l.read();if(t)break;i+=n.decode(s,{stream:!0});const d=i.split(`
`);i=d.pop()||"";for(const e of d)if(e.trim()!==""&&e.startsWith("data: ")){const c=e.slice(6);if(c==="[DONE]")return;try{yield JSON.parse(c)}catch(g){console.warn("Failed to parse SSE data:",g)}}}}</script>
</head>

<body>
    <h1>Analyzer Result</h1>
    <div id="filter-container"></div>
    <div id="container">
        <div id="keyword-list"></div>
        <div class="right-panel">
            <div class="split-container">
                <div id="log-display"></div>
                <div class="resizer"></div>
                <div id="analysis-result">Analysis results will be displayed here.</div>
            </div>
            <div class="flex justify-end mb-4">
                <button id="analyze-btn" class="btn btn-primary">分析日志</button>
            </div>
        </div>
    </div>

    <!-- 添加进度条HTML -->
    <div class="progress-container" id="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
        <div class="progress-text" id="progress-text">正在解析日志...</div>
    </div>

</body>

</html>