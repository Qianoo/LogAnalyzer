<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyzer Result</title>
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        h1 {
            text-align: center;
            padding: 10px;
            margin: 0;
            background-color: #f5f5f5;
            font-size: 1.5rem;
        }

        #container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #keyword-list {
            width: 20%;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            overflow-y: auto;
            padding: 15px;
        }

        .right-panel {
            width: 80%;
            display: flex;
            flex-direction: column;
        }

        #log-display {
            height: 70%;
            overflow-y: auto;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        #analysis-result {
            height: 30%;
            overflow-y: auto;
            padding: 15px;
            background-color: #ffffff;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .keyword {
            margin: 8px 0;
            padding: 8px 12px;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .keyword:hover {
            background-color: #e9ecef;
        }

        .highlight {
            background-color: #fff3cd;
            padding: 2px 0;
        }

        .line-number {
            color: #6c757d;
            margin-right: 10px;
            -webkit-user-select: none;
               -moz-user-select: none;
                    user-select: none;
        }

        .keyword-block {
            margin: 8px 0;
            padding: 6px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .keyword-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .keyword-tag {
            font-size: 0.8rem;
            padding: 2px 6px;
            margin: 2px;
            border-radius: 3px;
            background-color: #e7f3ff;
            border: 1px solid #b3d7ff;
            cursor: pointer;
        }

        .keyword-tag:hover {
            background-color: #cce5ff;
        }

        .keyword-tag .line-info {
            font-size: 0.8em;
            color: #666;
            margin-left: 4px;
        }

        .line-highlight {
            background-color: #fff3cd;
            animation: highlight 2s;
        }

        @keyframes highlight {
            from {
                background-color: #ffeeba;
            }

            to {
                background-color: #fff3cd;
            }
        }

        .block-header {
            padding: 5px 10px;
            background-color: #f0f0f0;
            border-bottom: 1px solid #ddd;
            font-weight: bold;
            margin-bottom: 10px;
        }

        #filter-container {
            padding: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .filter-tag {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 4px;
            cursor: pointer;
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
        }

        .filter-tag.active {
            background-color: #28a745;
            color: white;
        }

        .filter-tag.inactive {
            background-color: #e9ecef;
            color: #666;
        }

        .markdown {
            padding: 0.8rem;
            font-size: 0.9rem;
        }

        .markdown h1 {
            font-size: 1.4em;
            margin-top: 0.8em;
            margin-bottom: 0.4em;
        }

        .markdown h2 {
            font-size: 1.2em;
            margin-top: 0.8em;
            margin-bottom: 0.4em;
        }

        .markdown h3 {
            font-size: 1.1em;
            margin-top: 0.8em;
            margin-bottom: 0.4em;
        }

        .markdown ul,
        .markdown ol {
            padding-left: 1.5em;
            margin-bottom: 0.8em;
        }

        .markdown li {
            margin-bottom: 0.3em;
        }

        .markdown code {
            background-color: #f0f0f0;
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-family: monospace;
        }

        .markdown pre {
            background-color: #f5f5f5;
            padding: 1em;
            border-radius: 5px;
            overflow-x: auto;
            margin: 1em 0;
        }

        .markdown blockquote {
            border-left: 4px solid #ddd;
            padding-left: 1em;
            margin: 1em 0;
            color: #666;
        }

        .markdown p {
            margin-bottom: 0.8em;
        }

        /* 添加容器样式 */
        .split-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 150px);
            /* 减去其他元素的高度 */
            position: relative;
        }

        /* 日志显示窗口 */
        #log-display {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            min-height: 100px;
            /* 最小高度 */
        }

        /* 可拖动的分隔条 */
        .resizer {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            cursor: row-resize;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
        }

        /* 分隔条中间的线 */
        .resizer::after {
            content: '';
            display: block;
            width: 30px;
            height: 2px;
            background: #999;
            margin: 3px auto;
        }

        /* 分析结果窗口 */
        #analysis-result {
            height: 200px;
            /* 初始高度 */
            overflow-y: auto;
            padding: 10px;
            min-height: 100px;
            /* 最小高度 */
        }

        /* 拖动时的遮罩层 */
        .resize-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
        }

        /* 添加进度条样式 */
        .progress-container {
            display: none;
            /* 默认隐藏 */
            width: 100%;
            padding: 10px;
            background-color: #f5f5f5;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .progress-bar {
            width: 0%;
            height: 4px;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }

        .progress-text {
            font-size: 0.8rem;
            color: #666;
            text-align: center;
            margin-top: 4px;
        }

        /* 添加重复信息的样式 */
        .duplicate-info {
            background-color: #f0f0f0;
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #666;
        }
    </style>
  <script type="module" crossorigin>(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))u(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const t of a.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&u(t)}).observe(document,{childList:!0,subtree:!0});function l(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(i){if(i.ep)return;i.ep=!0;const a=l(i);fetch(i.href,a)}})();function F(r){const i=["Segmentation fault","core dumped","Bus error","undefined reference","stack overflow","double free","invalid pointer","malloc failed","SIGABRT","SIGSEGV","NullPointerException","ArrayIndexOutOfBoundsException","ClassNotFoundException","NoSuchMethodError","IllegalArgumentException","OutOfMemoryError","StackOverflowError","ClassCastException","ANR","FATAL EXCEPTION","ActivityManager: Force finishing activity","E/AndroidRuntime","W/ActivityThread","StrictMode","kernel panic","Oops","BUG:","Call Trace","slab corruption","general protection fault","I/O error","bad page state","Error","error","Critical","Failed","Exception","Timeout","Permission denied","Device not found"],a=new Map;for(const e of i)a.set(e,{regex:new RegExp(`\\b${e}\\b`),length:e.length});const t=new Set,o=new Map,c=r.split(`
`),n=c.length,g=new Array(30);let p=0,s=null,C=-1;function B(e){for(const[m,{regex:f,length:h}]of a)if(e.length>=h&&e.includes(m)&&f.test(e))return{keyword:m,matchedText:m};return null}function O(e,m){const f=e.indexOf(m);if(f===-1)return null;let h=f;for(;h>0&&e[h-1]!==" ";)h--;let E=f+m.length;for(;E<e.length&&e[E]!==" ";)E++;return{before:e.slice(h,f),after:e.slice(f+m.length,E)}}function D(e,m){const f=c[e];return`${e}-${m}-${f}`}for(let e=0;e<n;e++){const m=c[e];if(t.has(e))continue;g[p%g.length]=m,p++;const f=B(m);if(f){const{keyword:h,matchedText:E}=f;if(e===C+1){C=e,s&&(s.lines.push(m),t.add(e));continue}if(!O(m,E))continue;C=e;const k=D(e,Math.min(e+10,n));let w=o.get(k);if(w){w.lineNumbers.add(e),w.duplicateCount++,t.add(e);continue}const x=new Array(Math.min(300,11));let b=0;for(let S=Math.max(0,p-20);S<p;S++)x[b++]=g[S%g.length];w={startLine:Math.max(0,e-20),endLine:Math.min(e+10,n),keywords:[h],lines:x.slice(0,b),duplicateCount:1,lineNumbers:new Set([e]),summaryLine:m},o.set(k,w),s?e>s.endLine||s.lines.length>=300?s=w:(s.keywords.push(h),s.lines.push(m),s.lineNumbers.add(e)):s=w,t.add(e)}else s&&s.lines.length<300&&(s.lines.push(m),e>=s.endLine&&(s=null,p=0,C=-1))}const v=Array.from(o.values());for(const e of v){const m=Array.from(e.lineNumbers);m.sort((f,h)=>f-h),e.summary=`此日志模式重复出现了 ${e.duplicateCount} 次`,e.summaryLine=`行 ${m.join("、")}: ${e.summaryLine}`}return v}const M={defaultLogAnalysis:`作为日志分析专家,请你分析日志,推测可能出问题的模块,根据提供的owner联系列表,推测出模块的owner和Manager(最多输出3个可能的联系人),并按照下面的模板回复：

1. 概述
- 日志类型
- 涉及组件

2. 原因分析
- 问题根源
- 关联性分析
- 系统模块定位

3. 解决方案
- 修复建议
- 预防措施

4.可能的owner和Manager

请注意这是owner联系列表,你需要在owner联系列表中找到可能的联系人:
Platform (Manager: Victor Wan)
uboot: Tao Zeng
bl2: Tao Zeng
bl31: Tao Zeng
kernel: Jianxin Pan
bl30: Qiufang Dai
Storage drivers: Yonghui Yu
gpio: Qianggui Song
pinctrl: Qianggui Song
i2c: Jian Hu
clk tree: Jian Hu
spi: Sunny Luo
spi nand: Sunny Luo
spi nor flash: Sunny Luo
pwm: Bichao Zheng
emmc: Long Yu
sdio: Liang Yang
WIFI/BT: Larson Jiang
wifi driver: Rongjun Chen
wifi driver (freertos): Bo Li
wifi driver (buildroot): Jiabin Chen
bt driver: Qiu Zeng
secureos: Peifu Jiang, Pengguang Zhu, Rui Guo
freertos: Jianxiong Pan
usb: Yue Wang
ethernet phy: Zhuo Wang
uart: Qi Duan, Yu Tu
Audio (Manager: Jian Xu)
audio driver: Shuai Li
audio hal: Shuai Li
dsp driver: Jiebin Chen
audio eq/drc: Zhe Wang
dolby/dts MS12: Yujie Wu

Display / Graphic (Manager: Simon Zheng)
OSD: Brain Zhu
camera ISP: Xiaoxin Cao
Graphic: Sky Zhou
buildroot DRM: Ao Xu
NPU driver: Xingwei Zhou
NPU APP: Deng Liu
OSD driver: Pengcheng Chen
GE2D/GDC: Jian Cao
PIP: Jintao Xu
ISP driver: Junwei Ma, Jiacheng Mei, Keke Li
camera hal: Dong Wei
camera IQ: Yu Zhang

HDMI (Manager: Frank Zhao)
Panel Cvbs: Evoke Zhang
HDMI TX: Zongdong Jiao
HDMI RX: Lei Yang, Yicheng Shen
Media (Manager: Zhi Zhou)
decoder: Hui Zhang
Android player: Lifeng Cao
DRM player: Shipeng Sun, Tao Guo

Android AE (Manager: Tellen Yu)
TV framework: Kieth Liu
CEC: An Xi
camera apk: Jie Yuan
Android System: Shuide Chen
Android 公版 (Manager: Tao Dong)
OTT release: Gongwei Chen
TV release: Lei Qian
DS release: Chunlong Cao
system control: Kaifu Hu
burning tools: Yihui Wu
OTA: Zhigang Yu

Buildroot (Manager: Guofeng Tang)
RDK: Jun Zhang, Daogao Xu
IPC SDK: Hengrui Li, Zhengyu Gao, Xuequan Feng, Yongbin He, Qiang Wei
ISP/encoder SDK: Yang Su
HW (Manager: Kun Zhang)
DDR SW: Jiaxin Ye, Zhiguang Ouyang
IPC HW: Chuanting Xu
IPC/OTT HW: Yuanyuan Li
FAE HW: Linlin Cao
TV HW: Siwei Chen
HW: Jie Feng

IT
服务器: Jia Wang, Rocky Duan
设备: Jianjun Xi, Penghui Wang
QA (Managers: Xiuyue Zhang, Ping Xiong)
Amazon: Chen Chen
OTT: Lingling Yu
IPC: Nannan Meng
`,detailedLogAnalysis:`作为日志分析专家,请详细分析以下日志：

1. 日志概述
- 日志类型和格式
- 时间范围分析
- 涉及的系统组件
- 日志严重程度分布

2. 问题诊断
- 错误模式识别
- 异常事件时序
- 系统状态分析
- 性能指标评估

3. 根因分析
- 直接原因
- 潜在因素
- 系统瓶颈
- 组件间依赖

4. 解决方案
- 即时修复建议
- 长期优化方案
- 监控建议
- 预防措施`,simpleLogAnalysis:`简要分析此日志：
1. 问题描述
2. 原因分析
3. 解决方案`};function R(r="defaultLogAnalysis"){return`${M.owner_prompt}

${M[r]}`}async function H(){try{const d=await(await fetch("/config/custom-prompts.json")).json();Object.assign(M,d)}catch(r){console.warn("Failed to load custom prompts:",r)}}H();let L=[],I=[],y=new Map,N=null;const P=document.getElementById("filter-container"),_=document.getElementById("keyword-list"),T=document.getElementById("log-display"),$=window.markdownit({html:!0,linkify:!0,typographer:!0});window.addEventListener("message",async r=>{const d=document.getElementById("progress-container"),l=document.getElementById("progress-bar"),u=document.getElementById("progress-text");d.style.display="block",l.style.width="0%",u.textContent="正在解析日志文件...",await new Promise(i=>requestAnimationFrame(i));try{await new Promise(n=>setTimeout(n,0));const i=r.data;I=i.split(`
`);const a=I.length;u.textContent="正在解析日志内容...",L=await new Promise(n=>{setTimeout(()=>{const g=F(i);l.style.width="30%",n(g)},0)}),u.textContent="正在处理关键字...",await new Promise(n=>setTimeout(n,0));const t=new Set;for(let n=0;n<L.length;n++){L[n].keywords.forEach(s=>t.add(s));const p=Math.round(30+n/L.length*30);l.style.width=`${p}%`,n%10===0&&await new Promise(s=>setTimeout(s,0))}u.textContent="正在更新界面...",l.style.width="60%",await new Promise(n=>setTimeout(n,0)),P.innerHTML="",_.innerHTML="",y=new Map,t.forEach(n=>y.set(n,!0));let o=0;const c=t.size;for(const n of t){const g=document.createElement("span");g.className="filter-tag active",g.textContent=n,g.onclick=()=>{const s=y.get(n);y.set(n,!s),g.className=`filter-tag ${s?"inactive":"active"}`,A()},P.appendChild(g),o++;const p=Math.round(60+o/c*20);l.style.width=`${p}%`,o%5===0&&await new Promise(s=>setTimeout(s,0))}u.textContent="正在渲染内容...",l.style.width="80%",await new Promise(n=>setTimeout(n,0)),A(),l.style.width="100%",u.textContent="处理完成",setTimeout(()=>{d.style.display="none"},1e3)}catch(i){console.error("Error processing log:",i),u.textContent="处理出错: "+i.message,l.style.backgroundColor="#ff4444",setTimeout(()=>{d.style.display="none"},3e3)}});function X(r){T.innerHTML="";const d=document.createElement("div");d.className="block-header";const l=r.endLine-r.startLine+1,u=l>=500?" (Truncated to 500 lines)":"";if(d.textContent=`Log Block (Lines ${r.startLine+1} - ${r.endLine+1})${u}`,T.appendChild(d),I.slice(r.startLine,r.endLine+1).forEach((a,t)=>{const o=document.createElement("div"),c=r.startLine+t;o.id=`line-${c}`,o.innerHTML=`<span class="line-number">${c+1}</span>${a}`,r.keywords.some(n=>y.get(n)&&a.includes(n))&&o.classList.add("highlight"),T.appendChild(o)}),l>=500){const a=document.createElement("div");a.className="truncate-note",a.style.color="#666",a.style.padding="10px",a.style.fontStyle="italic",a.textContent="Note: Log block has been truncated to 500 lines for better performance.",T.appendChild(a)}}function A(){const r=document.getElementById("log-display"),d=document.getElementById("keyword-list"),l=document.getElementById("filter-container");r.innerHTML="",d.innerHTML="",l.innerHTML="";const u=new Set;L.forEach(t=>{t.keywords.forEach(o=>u.add(o))}),u.forEach(t=>{const o=document.createElement("span");o.className=`filter-tag ${y.get(t)?"active":"inactive"}`,o.textContent=t,o.onclick=()=>{const c=y.get(t);y.set(t,!c),o.className=`filter-tag ${c?"inactive":"active"}`,A()},l.appendChild(o)});const i=new Map,a=new Map;L.forEach(t=>{const o=Z(t);i.has(o)||(i.set(o,t),t.keywords.forEach(c=>{a.has(c)||a.set(c,[]),a.get(c).push(t)}))}),a.forEach((t,o)=>{if(y.get(o)){const c=document.createElement("div");c.className="keyword-block";const n=document.createElement("div");n.className="keyword",n.textContent=o,c.appendChild(n);const g=document.createElement("div");g.className="keyword-tags",t.forEach(p=>{const s=document.createElement("span");s.className="keyword-tag",s.textContent=`行 ${p.startLine+1}`,p.duplicateCount>1&&(s.textContent+=` (${p.duplicateCount}次)`),s.onclick=()=>X(p),g.appendChild(s)}),c.appendChild(g),d.appendChild(c)}}),i.forEach(t=>{if(t.keywords.some(o=>y.get(o))){const o=document.createElement("div");if(o.className="log-block",t.duplicateCount>1){const n=document.createElement("div");n.className="duplicate-info",n.textContent=`此日志模式重复出现 ${t.duplicateCount} 次`,o.appendChild(n)}const c=document.createElement("pre");c.textContent=t.lines.join(`
`),o.appendChild(c),r.appendChild(o)}})}function Z(r){return r.lines.map(l=>l.replace(/\[\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}.\d+\]/g,"").replace(/\d+\.\d+/g,"X.X").replace(/\[\d+\]/g,"[X]").replace(/pid:\d+/g,"pid:X").replace(/0x[0-9a-fA-F]+/g,"0xX").replace(/\b\d+\b/g,"X").trim().replace(/\s+/g," ")).join(`
`)}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("analyze-btn");r&&r.addEventListener("click",J)});async function J(){const r=document.getElementById("log-display"),d=document.getElementById("analysis-result"),l=document.getElementById("analyze-btn"),u=r.innerText;l.disabled=!0,l.textContent="分析中...",d.innerHTML='<div class="markdown">正在分析，请等待...</div>',N=new AbortController;try{const i=W("/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"system",content:R("defaultLogAnalysis")},{role:"user",content:u}],stream:!0}),signal:N.signal});d.innerHTML="";let a="";for await(const t of i){const o=t.choices[0].delta.content;if(o){a+=o;const c=$.render(a);d.innerHTML=`<div class="markdown">${c}</div>`}}}catch(i){console.error("Analysis error:",i),d.innerHTML=`<div class="markdown">分析出错: ${i.message}</div>`}finally{l.disabled=!1,l.textContent="分析日志"}}async function*W(r,d){const l=await fetch(r,d);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const u=l.body.getReader(),i=new TextDecoder;let a="";for(;;){const{value:t,done:o}=await u.read();if(o)break;a+=i.decode(t,{stream:!0});const c=a.split(`
`);a=c.pop()||"";for(const n of c)if(n.trim()!==""&&n.startsWith("data: ")){const g=n.slice(6);if(g==="[DONE]")return;try{yield JSON.parse(g)}catch(p){console.warn("Failed to parse SSE data:",p)}}}}</script>
</head>

<body>
    <h1>Analyzer Result</h1>
    <div id="filter-container"></div>
    <div id="container">
        <div id="keyword-list"></div>
        <div class="right-panel">
            <div class="split-container">
                <div id="log-display"></div>
                <div class="resizer"></div>
                <div id="analysis-result">Analysis results will be displayed here.</div>
            </div>
            <div class="flex justify-end mb-4">
                <button id="analyze-btn" class="btn btn-primary">分析日志</button>
            </div>
        </div>
    </div>

    <!-- 添加进度条HTML -->
    <div class="progress-container" id="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
        <div class="progress-text" id="progress-text">正在解析日志...</div>
    </div>

</body>

</html>